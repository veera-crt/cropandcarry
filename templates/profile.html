{% extends "base.html" %}

{% block content %}
<div class="animate-up" style="max-width: 600px; margin: 2rem auto; position: relative;">
    <div class="dashboard-card" style="padding: 3.5rem; border: 1px solid rgba(0,0,0,0.02);">
        <button onclick="toggleEdit()" class="btn-icon"
            style="position: absolute; top: 1.5rem; right: 1.5rem; background: var(--light); border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1rem; color: var(--text-muted); cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-pen"></i>
        </button>

        <div style="text-align: center; margin-bottom: 3.5rem;">
            <div
                style="width: 120px; height: 120px; background: var(--grad-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3.5rem; margin: 0 auto 1.5rem; font-weight: 800; box-shadow: 0 20px 40px -10px var(--primary-glow); border: 4px solid var(--white);">
                {{ user.name[0].upper() }}
            </div>
            <h1 style="font-size: 2.25rem; margin-bottom: 0.5rem;">{{ user.name }}</h1>
            <span class="badge"
                style="background: var(--primary-light); color: var(--primary); padding: 0.5rem 1.25rem; font-size: 0.85rem;">{{
                user.role|title }} Member</span>
        </div>

        <form action="{{ url_for('update_profile') }}" method="POST" id="profileForm">
            <div style="display: flex; flex-direction: column; gap: 1.75rem;">
                <div class="form-group">
                    <label
                        style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 800; margin-bottom: 0.5rem; display: block;">Email
                        Identity</label>
                    <div style="position: relative;">
                        <input type="text" value="{{ user.email }}" readonly
                            style="background: #f8fafc; cursor: not-allowed; color: var(--text-muted); border: 1px solid #e2e8f0;">
                        <i class="fas fa-lock"
                            style="position: absolute; right: 1.25rem; top: 50%; transform: translateY(-50%); color: #cbd5e1; font-size: 0.85rem;"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label
                        style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 800; margin-bottom: 0.5rem; display: block;">Mobile
                        Contact</label>
                    <input type="text" name="phone" id="phoneInput" value="{{ user.phone or '' }}"
                        placeholder="+91 00000 00000" readonly
                        style="background: #f8fafc; border: 1px solid transparent;">
                </div>

                <div class="form-group">
                    <label
                        style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 800; margin-bottom: 0.5rem; display: block;">Primary
                        Address</label>
                    <textarea name="address" id="addressInput" rows="3" placeholder="No address listed yet..." readonly
                        style="background: #f8fafc; resize: none; border: 1px solid transparent; line-height: 1.6;">{{ user.address or '' }}</textarea>
                </div>

                <div id="saveBtnWrapper" style="display: none; margin-top: 1rem;">
                    <button type="submit" class="btn-primary" style="width: 100%; height: 3.5rem;">
                        Update Profile &nbsp; <i class="fas fa-check-circle"></i>
                    </button>
                </div>

                <div style="margin-top: 3rem; border-top: 1px solid #f1f5f9; padding-top: 2.5rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 1.5rem; color: var(--dark);">Security & Session</h3>
                    <div style="display: flex; gap: 1rem;">
                        <a href="{{ url_for('change_password') }}" class="btn-primary"
                            style="flex: 1; height: 3rem; background: var(--dark); box-shadow: none; font-size: 0.9rem;">
                            <i class="fas fa-shield-alt"></i> &nbsp; Security Settings
                        </a>
                        <a href="{{ url_for('logout') }}"
                            style="flex: 1; height: 3rem; border-radius: 50px; display: flex; align-items: center; justify-content: center; border: 2px solid #fee2e2; color: #ef4444; font-weight: 700; font-size: 0.9rem; transition: var(--transition);">
                            <i class="fas fa-power-off"></i> &nbsp; Logout
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleEdit() {
        const phone = document.getElementById('phoneInput');
        const address = document.getElementById('addressInput');
        const saveBtn = document.getElementById('saveBtnWrapper');
        const inputs = [phone, address];

        const isReadonly = phone.hasAttribute('readonly');

        if (isReadonly) {
            inputs.forEach(input => {
                input.removeAttribute('readonly');
                input.style.backgroundColor = '#fff';
                input.style.border = '1px solid var(--primary)';
            });
            saveBtn.style.display = 'block';
            phone.focus();
        } else {
            inputs.forEach(input => {
                input.setAttribute('readonly', 'true');
                input.style.backgroundColor = '#f8fafc';
                input.style.border = '1px solid transparent';
            });
            saveBtn.style.display = 'none';
        }
    }
</script>
{% endblock %}