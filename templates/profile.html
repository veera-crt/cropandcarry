{% extends "base.html" %}

{% block content %}
<div style="position: relative;">
    <button onclick="toggleEdit()" class="btn-icon"
        style="position: absolute; top: 0; right: 0; background: none; border: none; font-size: 1.2rem; color: var(--text-light); cursor: pointer;">
        <i class="fas fa-pen"></i>
    </button>
    <div style="text-align: center; margin-bottom: 2rem;">
        <div
            style="width: 100px; height: 100px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 1rem; font-weight: bold;">
            {{ user.name[0].upper() }}
        </div>
        <h1 style="color: var(--primary-dark);">{{ user.name }}</h1>
        <span class="badge" style="background: var(--light); color: var(--text);">{{ user.role|title }}</span>
    </div>

    <form action="{{ url_for('update_profile') }}" method="POST" id="profileForm">
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div class="form-group">
                <label>Email Address</label>
                <input type="text" value="{{ user.email }}" readonly
                    style="background: #e9ecef; cursor: not-allowed; color: #6c757d;">
                <small style="color: #6c757d; font-size: 0.8rem;">Email cannot be changed</small>
            </div>

            <div class="form-group">
                <label>Phone Number</label>
                <input type="text" name="phone" id="phoneInput" value="{{ user.phone or '' }}"
                    placeholder="Enter phone number" readonly style="background: #f8f9fa; cursor: not-allowed;">
            </div>

            <div class="form-group">
                <label>Address</label>
                <textarea name="address" id="addressInput" rows="3" placeholder="Enter your address" readonly
                    style="background: #f8f9fa; cursor: not-allowed; resize: none;">{{ user.address or '' }}</textarea>
            </div>

            <div id="saveBtnWrapper" style="display: none; margin-top: 1rem;">
                <button type="submit" class="btn-submit" style="width: 100%;">Save Changes</button>
            </div>

            <div style="margin-top: 2rem; border-top: 1px solid #eee; padding-top: 1.5rem;">
                <h3>Account Settings</h3>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <a href="{{ url_for('change_password') }}" class="btn-submit"
                        style="text-decoration: none; flex: 1; text-align: center; background: var(--secondary); color: var(--dark) !important;">Change
                        Password</a>
                    <a href="{{ url_for('logout') }}" class="btn-logout"
                        style="border: 2px solid #e74c3c; padding: 0.6rem 1.5rem; border-radius: 50px; text-decoration: none; flex: 1; text-align: center; transition: all 0.3s; color: #e74c3c;">Logout</a>
                </div>
            </div>
        </div>
    </form>
</div>
</div>

<script>
    function toggleEdit() {
        const phone = document.getElementById('phoneInput');
        const address = document.getElementById('addressInput');
        const saveBtn = document.getElementById('saveBtnWrapper');
        const inputs = [phone, address];

        const isReadonly = phone.hasAttribute('readonly');

        if (isReadonly) {
            inputs.forEach(input => {
                input.removeAttribute('readonly');
                input.style.backgroundColor = '#fff';
                input.style.borderColor = 'var(--primary)';
                input.style.cursor = 'text';
            });
            saveBtn.style.display = 'block';
            phone.focus();
        } else {
            inputs.forEach(input => {
                input.setAttribute('readonly', 'true');
                input.style.backgroundColor = '#f8f9fa';
                input.style.borderColor = '#edf2f7';
                input.style.cursor = 'not-allowed';
            });
            saveBtn.style.display = 'none';
        }
    }
</script>
{% endblock %}