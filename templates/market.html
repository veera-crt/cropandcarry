{% extends "base.html" %}

{% block content %}
<div class="hero animate-up">
    <h1>Freshness, Delivered.<br><span style="color: var(--primary)">From Farm to Home.</span></h1>
    <p>Experience the luxury of premium local produce. Directly sourced, ethically grown, and delivered with care.</p>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem;"
    class="animate-up">
    <h2><span style="border-bottom: 3px solid var(--primary); padding-bottom: 8px;">Explore Marketplace</span></h2>
    <div style="display: flex; gap: 1rem;">
        <span
            style="background: var(--white); padding: 0.5rem 1rem; border-radius: var(--radius-full); font-weight: 600; font-size: 0.85rem; border: 1px solid var(--glass-border); color: var(--primary);">
            <i class="fas fa-filter"></i> All Products
        </span>
    </div>
</div>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card animate-up" style="animation-delay: {{ loop.index0 * 0.1 }}s">
        <div class="img-wrapper">
            {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-img">
            {% else %}
            <div class="product-img"
                style="display: flex; align-items: center; justify-content: center; background: #f1f5f9; color: #94a3b8; font-weight: 600;">
                <i class="fas fa-image" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
            </div>
            {% endif %}
            <div
                style="position: absolute; top: 1rem; left: 1rem; background: rgba(255,255,255,0.9); padding: 0.4rem 0.8rem; border-radius: 50px; font-size: 0.75rem; font-weight: 700; backdrop-filter: blur(4px);">
                <i class="fas fa-user-circle" style="color: var(--primary);"></i> {{ product.farmer.name }}
            </div>
        </div>

        <div class="product-info">
            <h3 class="product-title">{{ product.name }}</h3>
            <p
                style="font-size: 0.875rem; color: var(--text-muted); line-height: 1.5; margin-bottom: 1.5rem; height: 3rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                {{ product.description or 'Freshly harvested produce from local sustainable farms.' }}
            </p>

            <div class="product-meta">
                <span class="product-price">â‚¹{{ '{:,.0f}'.format(product.price) }}<span
                        style="font-size: 0.9rem; color: var(--text-muted); font-weight: 500;">/{{ product.unit
                        }}</span></span>
                {% if product.stock > 0 %}
                <span class="badge" style="background: var(--primary-light); color: var(--primary);">{{ product.stock }}
                    {{ product.unit }} Left</span>
                {% else %}
                <span class="badge" style="background: #fee2e2; color: #ef4444;">Sold Out</span>
                {% endif %}
            </div>

            {% if current_user.is_authenticated and current_user.role == 'consumer' and product.stock > 0 %}
            <a href="{{ url_for('add_to_cart', id=product.id) }}" class="btn-primary"
                style="width: 100%; margin-top: 1.5rem;">
                <i class="fas fa-plus"></i> &nbsp; Add to Basket
            </a>
            {% elif not current_user.is_authenticated and product.stock > 0 %}
            <a href="{{ url_for('login') }}" class="btn-primary"
                style="width: 100%; margin-top: 1.5rem; background: var(--dark);">
                Login to Buy
            </a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}