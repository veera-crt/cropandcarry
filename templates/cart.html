{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 3rem;" class="animate-up">
    <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Your Basket</h1>
    <p style="color: var(--text-muted);">Review your fresh selections before we harvest them for you.</p>
</div>

{% if cart_items %}
<div style="display: grid; grid-template-columns: 1fr 380px; gap: 3rem; align-items: flex-start;" class="animate-up">
    <div style="display: grid; gap: 1.5rem;">
        {% for item in cart_items %}
        <div class="cart-item"
            style="background: var(--white); border-radius: var(--radius-xl); padding: 1.5rem; display: grid; grid-template-columns: 100px 1fr auto auto; align-items: center; gap: 2rem; border: 1px solid rgba(0,0,0,0.02); box-shadow: var(--shadow-premium);">
            <div
                style="width: 100px; height: 100px; border-radius: var(--radius-lg); background: #f1f5f9; overflow: hidden; border: 1px solid #f1f5f9;">
                {% if item.product.image_url %}
                <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}"
                    style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                <div
                    style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #cbd5e1;">
                    <i class="fas fa-leaf fa-2x"></i>
                </div>
                {% endif %}
            </div>

            <div>
                <h3 style="font-size: 1.25rem; margin-bottom: 0.25rem;">{{ item.product.name }}</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); font-weight: 600;">
                    <i class="fas fa-store" style="color: var(--primary);"></i> {{ item.product.farmer.name }}
                </p>
                <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 0.5rem;">Unit Price: ₹{{ item.product.price }}
                </p>
            </div>

            <div style="display: flex; align-items: center; gap: 1rem;">
                <form action="{{ url_for('update_cart_quantity') }}" method="POST"
                    style="display: flex; align-items: center; background: var(--light); padding: 0.5rem; border-radius: var(--radius-full);">
                    <input type="hidden" name="product_id" value="{{ item.product.id }}">
                    <button type="button"
                        onclick="const input = this.parentNode.querySelector('input[name=quantity]'); input.value = Math.max(1, parseInt(input.value)-1); this.form.submit();"
                        style="background: none; border: none; padding: 0 0.5rem; cursor: pointer; color: var(--text-muted);"><i
                            class="fas fa-minus-circle"></i></button>
                    <input type="number" name="quantity" value="{{ item.quantity }}" min="1"
                        max="{{ item.product.stock }}" readonly
                        style="width: 40px; text-align: center; background: none; border: none; font-weight: 700; color: var(--dark);">
                    <button type="button"
                        onclick="const input = this.parentNode.querySelector('input[name=quantity]'); input.value = Math.min({{ item.product.stock }}, parseInt(input.value)+1); this.form.submit();"
                        style="background: none; border: none; padding: 0 0.5rem; cursor: pointer; color: var(--primary);"><i
                            class="fas fa-plus-circle"></i></button>
                </form>
                <div style="font-size: 0.85rem; color: var(--text-muted); font-weight: 600;">{{ item.product.unit }}
                </div>
            </div>

            <div style="text-align: right;">
                <div style="font-size: 1.25rem; font-weight: 800; color: var(--dark); margin-bottom: 0.5rem;">₹{{
                    '{:,.2f}'.format(item.total) }}</div>
                <a href="{{ url_for('remove_from_cart', id=item.product.id) }}"
                    style="color: #64748b; font-size: 0.9rem; transition: var(--transition);" class="h-text-red">
                    <i class="fas fa-trash-alt"></i> Remove
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="dashboard-card"
        style="padding: 2.5rem; position: sticky; top: 6rem; background: var(--dark); color: var(--white); border: none;">
        <h2 style="color: var(--white); margin-bottom: 2rem;">Order Summary</h2>

        <div
            style="display: flex; justify-content: space-between; margin-bottom: 1.25rem; color: rgba(255,255,255,0.6); font-weight: 600;">
            <span>Subtotal</span>
            <span style="color: var(--white);">₹{{ '{:,.2f}'.format(total) }}</span>
        </div>
        <div
            style="display: flex; justify-content: space-between; margin-bottom: 1.25rem; color: rgba(255,255,255,0.6); font-weight: 600;">
            <span>Delivery Fee</span>
            <span style="color: var(--primary);">FREE</span>
        </div>

        <div
            style="margin: 2rem 0; padding: 2rem 0; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <span style="font-size: 1.1rem; font-weight: 600;">Total</span>
                <span style="font-size: 2.25rem; font-weight: 800; color: var(--primary);">₹{{ '{:,.2f}'.format(total)
                    }}</span>
            </div>
        </div>

        <form action="{{ url_for('checkout') }}" method="POST">
            <div class="form-group" style="margin-bottom: 2rem;">
                <label
                    style="color: rgba(255,255,255,0.6); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700;">Select
                    Payment Method</label>
                <div style="position: relative; margin-top: 0.75rem;">
                    <select name="payment_method"
                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: var(--white); appearance: none; -webkit-appearance: none;">
                        <option value="UPI">UPI / Digital Wallet</option>
                        <option value="COD">Cash on Delivery</option>
                    </select>
                    <i class="fas fa-chevron-down"
                        style="position: absolute; right: 1.25rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: rgba(255,255,255,0.4);"></i>
                </div>
            </div>
            <button type="submit" class="btn-primary" style="width: 100%; height: 4rem; font-size: 1.2rem;">
                <i class="fas fa-check-circle"></i> &nbsp; Finalize Checkout
            </button>
        </form>
        <p
            style="text-align: center; color: rgba(255,255,255,0.4); font-size: 0.8rem; margin-top: 1.5rem; font-weight: 500;">
            <i class="fas fa-shield-alt"></i> Secure checkout powered by Stripe
        </p>
    </div>
</div>
{% else %}
<div class="dashboard-card animate-up" style="text-align: center; padding: 6rem 2rem;">
    <div
        style="width: 100px; height: 100px; background: var(--primary-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2.5rem;">
        <i class="fas fa-shopping-cart" style="font-size: 2.5rem; color: var(--primary);"></i>
    </div>
    <h2 style="font-size: 2rem; margin-bottom: 1rem;">Your basket is empty</h2>
    <p style="color: var(--text-muted); margin-bottom: 3rem; max-width: 450px; margin-left: auto; margin-right: auto;">
        It looks like you haven't added anything yet. Explore our market for the freshest seasonal produce.</p>
    <a href="{{ url_for('index') }}" class="btn-primary" style="padding: 1rem 2.5rem;">Go to Market</a>
</div>
{% endif %}
{% endblock %}